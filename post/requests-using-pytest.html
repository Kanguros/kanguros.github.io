<!DOCTYPE html>
<html lang="en">

<head>
        <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>
    Requests using pytest - Kamil's Scratchpad
    </title>

    <!-- Bootstrap and Clean Blog CSS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Sans:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400;1,500&display=swap"
          rel="stylesheet">

    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
          crossorigin="anonymous"
    >
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    >
    <link rel="stylesheet"
          href="https://kanguros.github.io/theme/css/code_blocks/darkly.css"
    >
    <link rel="stylesheet"
          href="https://kanguros.github.io/theme/css/clean-blog.css"
    >



        <meta name="description" content="Small setup for testing HTTP requests using pytest">

        <meta name="tags" content="pytest">
        <meta name="tags" content="requests">
        <meta name="tags" content="python">

        <meta property="og:locale" content="en">
    <meta property="og:site_name" content="Kamil's Scratchpad">

    <meta property="og:type" content="article">
    <meta property="og:url" content="https://kanguros.github.io/post/requests-using-pytest.html">
    <meta property="og:title" content="Requests using pytest">
    <meta property="article:published_time" content="2023-09-02 00:00:00+02:00">

        <meta property="og:description" content="Small setup for testing HTTP requests using pytest">

        <meta property="og:image" content="https://kanguros.github.io/theme/images/post-bg.jpg">

</head>

<body class="article-requests-using-pytest d-flex flex-column vh-100">
<div class="col-lg-8 offset-lg-2 col-md-10 offset-md-1">
    <nav class="navbar container align-items-center px-2 mt-2 mb-1">
        <a class="brand" href="https://kanguros.github.io">
            Kamil's Scratchpad
        </a>
        <ul class="nav">
            <li class="nav-item">
                <a class="btn-navigation my-2 float-end nav-link"
                   href="https://kanguros.github.io/tag/index.html"
                   title="Tags"
                   aria-label="Tags"
                >Tags</a>
            </li>
            <li class="nav-item">
                <a class="btn-navigation my-2 float-end nav-link"
                   href="https://kanguros.github.io/about.html"
                   title="About"
                   aria-label="About"
                >About</a>
            </li>
            <li class="nav-item">
                <a class="btn-navigation my-2 float-end nav-link"
                   href="https://github.com/Kanguros/"
                   title="Git"
                   aria-label="Git"
                >Git</a>
            </li>
        </ul>
    </nav>
    <hr class="nav-line">
</div>
<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 offset-lg-2 col-md-10 offset-md-1">
    <div class="article-heading">
        <a href="https://kanguros.github.io/post/requests-using-pytest.html" rel="bookmark" title="Requests using pytest">
            <h1>
                Requests using pytest
            </h1>
        </a>
        <p class="meta-element">
            
<i class="bi bi-calendar"></i> 2023-09-02
<i class="bi bi-dot"></i>
<i class="bi bi-book"></i> 7 minutes


        </p>
        <div class="tags meta-element">
    <a href="/tag/pytest.html"
       rel="bookmark"
       title="Posts with #pytest tag"
       aria-label="Posts with #pytest tag"
    >#pytest</a>
    <a href="/tag/requests.html"
       rel="bookmark"
       title="Posts with #requests tag"
       aria-label="Posts with #requests tag"
    >#requests</a>
    <a href="/tag/python.html"
       rel="bookmark"
       title="Posts with #python tag"
       aria-label="Posts with #python tag"
    >#python</a>
</div>

    </div>
            </div>
        </div>
    </div>
</header>

<div class="container">
    <div class="row">
        <div class="col-lg-8 offset-lg-2 col-md-10 offset-md-1">
    <article>
            <p>Small setup for testing <span class="caps">HTTP</span> requests using&nbsp;pytest</p>
        <h1 id="pytest-and-requests"><a class="toclink" href="#pytest-and-requests">Pytest and&nbsp;requests</a></h1>
<p>This module provides a pytest fixture to mock <span class="caps">HTTP</span> requests.
It provide custom responses based on response&nbsp;files.</p>
<h2 id="response-files"><a class="toclink" href="#response-files">Response&nbsp;files</a></h2>
<p>Response files are organized in the &#8216;tests/responses&#8217;&nbsp;directory.</p>
<p>Each response file is placed within a subdirectory named after the <span class="caps">URI</span> of the <span class="caps">URL</span> being tested.
This ensures responses are matched accurately with test&nbsp;URLs.</p>
<h3 id="file-naming"><a class="toclink" href="#file-naming">File&nbsp;naming</a></h3>
<p>Response files should be named based on the following&nbsp;convention:</p>
<div class="highlight"><pre><span></span><code>HTTP_METHOD_query_parameters.txt
</code></pre></div>

<ul>
<li>HTTP_METHOD represents the <span class="caps">HTTP</span> method to be mocked (e.g., <span class="caps">GET</span>, <span class="caps">POST</span>).</li>
<li>query<em>parameters represent query parameters, separated by underscores (</em>) if there are&nbsp;multiple.</li>
</ul>
<h2 id="running-tests"><a class="toclink" href="#running-tests">Running&nbsp;Tests</a></h2>
<p>When a test function is executed, it uses the <code>http_request_fixture</code> to intercept <span class="caps">HTTP</span> requests and
It return custom responses based on the corresponding response&nbsp;file.</p>
<h2 id="adding-new-response"><a class="toclink" href="#adding-new-response">Adding new&nbsp;response</a></h2>
<ol>
<li>Go to the &#8216;tests/responses&#8217;&nbsp;directory.</li>
<li>Create a subdirectory for the endpoint you want to mock or locate the existing&nbsp;one.</li>
<li>Inside the endpoint directory, create a text file with this name format:
   <code>HTTP_METHOD_query_parameters.txt</code></li>
</ol>
<p>HTTP_METHOD with the <span class="caps">HTTP</span> method (e.g., <span class="caps">GET</span>, <span class="caps">POST</span>).
   query_parameters with the query parameters, separated by underscores if&nbsp;multiple.</p>
<ol>
<li>Open the file and format it like&nbsp;this:</li>
</ol>
<div class="highlight"><pre><span></span><code># status code: STATUS_CODE
# reason: REASON
BODY
</code></pre></div>

<ol>
<li>Replace:</li>
<li><code>STATUS_CODE</code> with the desired <span class="caps">HTTP</span> status code (e.g., 200,&nbsp;404).</li>
<li><code>REASON</code> with the reason for the status code (e.g., &#8220;<span class="caps">OK</span>&#8221;, &#8220;Not&nbsp;Found&#8221;).</li>
<li><code>BODY</code> with the response content to&nbsp;mock.</li>
<li>Save the&nbsp;file.</li>
</ol>
<h3 id="example"><a class="toclink" href="#example">Example</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="c1"># Import the custom fixture from conftest.py</span>
<span class="kn">from</span> <span class="nn">conftest</span> <span class="kn">import</span> <span class="n">http_request_fixture</span>


<span class="k">def</span> <span class="nf">test_http_request</span><span class="p">(</span><span class="n">http_request_fixture</span><span class="p">):</span>
    <span class="c1"># Define the URL to make an HTTP request</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://example.com/path/to/resource?param1=value1&amp;param2=value2&quot;</span>

    <span class="c1"># Perform an HTTP request</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

    <span class="c1"># Check the response status code</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">404</span>  <span class="c1"># This status code comes from the response file</span>

    <span class="c1"># Check the response reason</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">reason</span> <span class="o">==</span> <span class="s2">&quot;Not Found&quot;</span>

    <span class="c1"># Check the response content (assuming a specific expected response in the file)</span>
    <span class="n">expected_response</span> <span class="o">=</span> <span class="s2">&quot;Response body content for 404 status code&quot;</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="n">expected_response</span>
</code></pre></div>

<p><strong>Mock file&nbsp;path</strong></p>
<div class="highlight"><pre><span></span><code><span class="p">|</span>-<span class="w"> </span>tests
<span class="w">   </span><span class="p">|</span>-<span class="w"> </span>responses
<span class="w">      </span><span class="p">|</span>-<span class="w"> </span>path_to_resource
<span class="w">         </span><span class="p">|</span>-<span class="w"> </span>param1_value1_param2_value2.txt
</code></pre></div>

<p><strong>Mock file&nbsp;content</strong></p>
<div class="highlight"><pre><span></span><code># status_code: 404
# reason: Not Found
Response body content for 404 status code
</code></pre></div>

<h2 id="code"><a class="toclink" href="#code">Code</a></h2>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlparse</span><span class="p">,</span> <span class="n">parse_qs</span>

<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">requests</span> <span class="kn">import</span> <span class="n">Response</span>

<span class="n">BASE_RESPONSE_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;tests&quot;</span><span class="p">,</span> <span class="s2">&quot;responses&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_response_file</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the response file path based on the URL.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parsed_url</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">path_parts</span> <span class="o">=</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="n">method</span> <span class="o">=</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">scheme</span>

    <span class="n">query_params</span> <span class="o">=</span> <span class="n">parse_qs</span><span class="p">(</span><span class="n">parsed_url</span><span class="o">.</span><span class="n">query</span><span class="p">)</span>
    <span class="n">query_str</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">query_params</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">])</span>

    <span class="n">dir_name</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_parts</span><span class="p">)</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">query_str</span><span class="si">}</span><span class="s2">.txt&quot;</span>

    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_RESPONSE_PATH</span><span class="p">,</span> <span class="n">dir_name</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">load_response_content</span><span class="p">(</span><span class="n">response_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load the content of a response file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">response_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">extract_response_info</span><span class="p">(</span><span class="n">content_lines</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Response</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract response information from response content lines and create a Response object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">status_code</span> <span class="o">=</span> <span class="mi">200</span>
    <span class="n">reason</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">body</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content_lines</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;# &quot;</span><span class="p">):</span>
            <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">line_parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">line_key</span> <span class="o">=</span> <span class="n">line_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">line_value</span> <span class="o">=</span> <span class="n">line_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="k">if</span> <span class="s2">&quot;status_code&quot;</span> <span class="ow">in</span> <span class="n">line_key</span><span class="p">:</span>
                <span class="n">status_code</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s2">&quot;reason&quot;</span> <span class="ow">in</span> <span class="n">line_key</span><span class="p">:</span>
                <span class="n">reason</span> <span class="o">=</span> <span class="n">line_value</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">Response</span><span class="p">()</span>
    <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">=</span> <span class="n">status_code</span>
    <span class="n">response</span><span class="o">.</span><span class="n">reason</span> <span class="o">=</span> <span class="n">reason</span>
    <span class="n">response</span><span class="o">.</span><span class="n">_content</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">body</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">http_request_fixture</span><span class="p">(</span><span class="n">monkeypatch</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pytest fixture to mock HTTP requests and provide custom responses based on response files.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">mock_request</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">response_file</span> <span class="o">=</span> <span class="n">get_response_file</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">content_lines</span> <span class="o">=</span> <span class="n">load_response_content</span><span class="p">(</span><span class="n">response_file</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">extract_response_info</span><span class="p">(</span><span class="n">content_lines</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">response</span>

    <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">sessions</span><span class="o">.</span><span class="n">Session</span><span class="p">,</span> <span class="s2">&quot;request&quot;</span><span class="p">,</span> <span class="n">mock_request</span><span class="p">)</span>
</code></pre></div>

<h2 id="extracting-responses-from-actual-api"><a class="toclink" href="#extracting-responses-from-actual-api">Extracting Responses from actual <span class="caps">API</span></a></h2>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlparse</span><span class="p">,</span> <span class="n">parse_qs</span>

<span class="kn">from</span> <span class="nn">requests</span> <span class="kn">import</span> <span class="n">Response</span>


<span class="k">class</span> <span class="nc">ApiWrapper</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Initialize your API client here</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Response</span><span class="p">:</span>
        <span class="k">pass</span>


<span class="k">def</span> <span class="nf">execute_and_save_responses</span><span class="p">(</span><span class="n">api</span><span class="p">:</span> <span class="n">ApiWrapper</span><span class="p">):</span>
    <span class="n">responses</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Define the methods to execute with arguments</span>
    <span class="n">methods_to_execute</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">api</span><span class="o">.</span><span class="n">get_data</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># No arguments</span>
        <span class="c1"># Add more methods with their respective arguments as needed</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="n">method</span><span class="p">,</span> <span class="n">args</span> <span class="ow">in</span> <span class="n">methods_to_execute</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>  <span class="c1"># Call the method with arguments</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">method</span><span class="p">()</span>  <span class="c1"># Call the method without arguments</span>

        <span class="c1"># Convert the response data to a string for saving</span>
        <span class="n">file_content</span> <span class="o">=</span> <span class="n">prepare_file_content</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="c1"># Get the URL associated with the method (for response file path)</span>
        <span class="n">request_url</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">url</span>

        <span class="n">response_file_path</span> <span class="o">=</span> <span class="n">get_response_file</span><span class="p">(</span><span class="n">request_url</span><span class="p">)</span>
        <span class="n">save_response</span><span class="p">(</span><span class="n">response_file_path</span><span class="p">,</span> <span class="n">file_content</span><span class="p">)</span>

        <span class="n">responses</span><span class="p">[</span><span class="n">method</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span> <span class="o">=</span> <span class="n">response_file_path</span>

    <span class="k">return</span> <span class="n">responses</span>


<span class="k">def</span> <span class="nf">get_response_file</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">parsed_url</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">path_parts</span> <span class="o">=</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="n">method</span> <span class="o">=</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">scheme</span>
    <span class="n">query_params</span> <span class="o">=</span> <span class="n">parse_qs</span><span class="p">(</span><span class="n">parsed_url</span><span class="o">.</span><span class="n">query</span><span class="p">)</span>

    <span class="n">query_str</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">query_params</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;tests&quot;</span><span class="p">,</span> <span class="s2">&quot;responses&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_parts</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">query_str</span><span class="si">}</span><span class="s2">.txt&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">prepare_file_content</span><span class="p">(</span><span class="n">response</span><span class="p">:</span> <span class="n">Response</span><span class="p">):</span>
    <span class="n">content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;# status_code: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span>
<span class="s2">    # reason: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">reson</span><span class="si">}</span>
<span class="s2">    </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="si">}</span>

<span class="s2">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">content</span>


<span class="k">def</span> <span class="nf">save_response</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">file_path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">api</span> <span class="o">=</span> <span class="n">ApiWrapper</span><span class="p">()</span>
    <span class="n">responses</span> <span class="o">=</span> <span class="n">execute_and_save_responses</span><span class="p">(</span><span class="n">api</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Responses saved successfully! </span><span class="si">{</span><span class="n">responses</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
    </article>


        </div>
    </div>
</div>

<footer class="col-lg-8 offset-lg-2 col-md-10 offset-md-1">
    <hr class="section-line">
    <p class="footer-links mt-3 mb-1">
        <a href="https://kanguros.github.io"
           class="px-2"
           title="Index"
           aria-label="Index"
        >Index</a>
        <a href="https://kanguros.github.io/tag/index.html"
           class="px-2"
           title="Tags"
           aria-label="Tags"
        >Tags</a>
        <a href="https://kanguros.github.io/about.html"
           class="px-2"
           title="About"
           aria-label="About"
        >About</a>
        <a href="https://github.com/Kanguros/"
           class="px-2"
           title="Git"
           aria-label="Git"
        >Git</a>
    </p>
    <p class="copyright">
        &copy; Made by
        <a href="https://kanguros.github.io/about.html">Kamil Urbanek</a>, powered by
        <a href="https://getpelican.com">Pelican</a>
    </p>
</footer>
<script src="https://kanguros.github.io/theme/js/clean-blog.js"></script>
</body>
</html>